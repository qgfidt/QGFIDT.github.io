<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>专属页面</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: "Arial", "Microsoft YaHei", sans-serif;
            text-align: center;
            min-height: 100vh;
            background: #f0f8ff;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            touch-action: manipulation;
        }
        .container {
            max-width: 550px;
            width: 100%;
            padding: 25px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        }
        h1 {
            color: #2196F3;
            font-size: 28px;
            margin-bottom: 25px;
        }
        .timer-box {
            margin: 20px 0;
            padding: 20px;
            background: #e8f4f8;
            border-radius: 8px;
        }
        .timer-display {
            font-size: 22px;
            color: #333;
            margin: 15px 0;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .timer-btns {
            margin: 10px 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
        }
        .btn {
            padding: 9px 18px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 15px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .btn:hover {
            background: #1976D2;
        }
        .btn-special {
            background: #ff7043;
        }
        .btn-special:hover {
            background: #f4511e;
        }
        .diary-box {
            margin: 25px 0;
        }
        textarea {
            width: 100%;
            height: 100px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            resize: none;
            font-size: 15px;
            margin: 10px 0;
            outline: none;
            transition: border 0.2s;
        }
        textarea:focus {
            border-color: #2196F3;
        }
        .diary-list {
            max-height: 150px;
            overflow-y: auto;
            text-align: left;
            margin-top: 10px;
            padding-right: 5px;
        }
        .diary-item {
            padding: 8px;
            margin-bottom: 8px;
            background: #f9f9f9;
            border-radius: 4px;
            font-size: 14px;
        }
        .diary-item strong {
            color: #2196F3;
        }
        #clearCode {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 180px;
            margin-right: 8px;
            margin-top: 10px;
            outline: none;
            transition: border 0.2s;
        }
        #clearCode:focus {
            border-color: #2196F3;
        }
        .clear-trigger {
            margin-top: 10px;
            color: #999;
            font-size: 12px;
            cursor: pointer;
            user-select: none;
        }
        .clear-trigger:hover {
            color: #666;
        }
        .music-tip {
            font-size: 12px;
            color: #999;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>欢迎你的到来！</h1>

        <div class="music-tip" id="musicTip">加载音乐中... 点击/滑动页面可触发播放</div>

        <div class="timer-box">
            <h3>计时统计</h3>
            <div class="timer-display">
                已记录：<span id="timeCount">0 天 0 时 0 分 0 秒</span>
            </div>
            <div class="timer-btns">
                <button onclick="startTimerNow()" class="btn">从现在开始计时</button>
                <button onclick="selectStartDate()" class="btn">选择日期开始计时</button>
                <button onclick="resetTimerToSpecialDate()" class="btn btn-special">重置为2007-08-08</button>
            </div>
        </div>

        <!-- 修复音乐链接可能的编码问题 -->
        <audio id="musicPlayer" loop preload="auto">
            <source src="0623.周杰伦-晴天.mp3" type="audio/mpeg">
            您的浏览器不支持音频播放
        </audio>

        <div class="diary-box">
            <h3>每日日记</h3>
            <textarea id="diaryContent" placeholder="记录今天的心情..."></textarea>
            <button onclick="saveDiary()" class="btn">保存日记</button>
            <input type="text" id="clearCode" placeholder="输入密码清空日记" style="display: none;">
            <button onclick="checkClearCode()" class="btn btn-special" style="display: none;">确认清空</button>
            <div class="diary-list" id="diaryList"></div>
        </div>

        <div class="clear-trigger" onclick="triggerClearEntry()">
            点击5次显示日记清空功能
        </div>
    </div>

    <script>
        let timerInterval;
        const SPECIAL_DATE = new Date(2007, 7, 8);
        let clickCount = 0;
        let musicPlayed = false;
        const audio = document.getElementById('musicPlayer');
        const musicTip = document.getElementById('musicTip');

        // 音乐播放逻辑
        window.addEventListener('DOMContentLoaded', () => {
            // 尝试自动播放
            audio.play().then(handleMusicPlaySuccess).catch(() => {
                musicTip.textContent = '点击/滑动页面即可播放音乐';
                
                // 绑定触发事件
                const handlePlayTrigger = () => {
                    if (!musicPlayed) {
                        audio.play().then(handleMusicPlaySuccess).catch(() => {
                            musicTip.textContent = '播放失败，请刷新页面重试';
                        });
                    }
                };

                document.addEventListener('click', handlePlayTrigger, { once: true });
                document.addEventListener('touchmove', handlePlayTrigger, { once: true, passive: true });
                document.addEventListener('mousemove', handlePlayTrigger, { once: true });
            });

            // 监听音乐错误
            audio.addEventListener('error', () => {
                musicTip.textContent = '音乐加载失败，请检查文件';
            });
        });

        function handleMusicPlaySuccess() {
            musicPlayed = true;
            musicTip.textContent = '正在播放：周杰伦 - 晴天';
            setTimeout(() => {
                musicTip.style.opacity = '0.5';
            }, 3000);
        }

        // 计时功能
        function initTimer() {
            const savedStart = localStorage.getItem('timerStart');
            const startDate = savedStart ? new Date(savedStart) : SPECIAL_DATE;
            
            if (isNaN(startDate.getTime())) {
                localStorage.removeItem('timerStart');
                startDate = SPECIAL_DATE;
            }
            
            updateTimerDisplay(startDate);
            startTimerInterval();
        }

        function startTimerNow() {
            const now = new Date();
            localStorage.setItem('timerStart', now.toISOString());
            updateTimerDisplay(now);
            restartTimerInterval();
        }

        function selectStartDate() {
            const dateStr = prompt('请输入开始日期（格式：YYYY-MM-DD）', new Date().toISOString().split('T')[0]);
            if (!dateStr) return;
            
            const selectedDate = new Date(dateStr);
            if (isNaN(selectedDate.getTime())) {
                alert('日期格式错误！请输入类似 2024-01-01 的格式');
                return;
            }
            
            if (selectedDate > new Date()) {
                alert('不能选择未来的日期哦！');
                return;
            }
            
            localStorage.setItem('timerStart', selectedDate.toISOString());
            updateTimerDisplay(selectedDate);
            restartTimerInterval();
        }

        function resetTimerToSpecialDate() {
            localStorage.setItem('timerStart', SPECIAL_DATE.toISOString());
            updateTimerDisplay(SPECIAL_DATE);
            restartTimerInterval();
        }

        function updateTimerDisplay(startDate) {
            const now = new Date();
            const timeDiff = Math.max(0, now - startDate);

            const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);

            const formatNum = num => num.toString().padStart(2, '0');
            document.getElementById('timeCount').textContent = 
                `${formatNum(days)} 天 ${formatNum(hours)} 时 ${formatNum(minutes)} 分 ${formatNum(seconds)} 秒`;
        }

        function startTimerInterval() {
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                const savedStart = localStorage.getItem('timerStart');
                if (savedStart) {
                    updateTimerDisplay(new Date(savedStart));
                }
            }, 1000);
        }

        function restartTimerInterval() {
            clearInterval(timerInterval);
            startTimerInterval();
        }

        // 日记功能
        function saveDiary() {
            const content = document.getElementById('diaryContent').value.trim();
            if (!content) {
                alert('日记内容不能为空哦！');
                return;
            }

            const diary = {
                id: Date.now(),
                date: new Date().toLocaleDateString(),
                content: content
            };

            const diaries = JSON.parse(localStorage.getItem('diaries') || '[]');
            diaries.push(diary);
            localStorage.setItem('diaries', JSON.stringify(diaries));

            document.getElementById('diaryContent').value = '';
            renderDiaries();
        }

        function renderDiaries() {
            const list = document.getElementById('diaryList');
            const diaries = JSON.parse(localStorage.getItem('diaries') || '[]');
            diaries.sort((a, b) => b.id - a.id);

            let html = '';
            diaries.forEach(item => {
                html += `
                    <div class="diary-item">
                        <strong>${item.date}</strong>：${escapeHtml(item.content)}
                    </div>
                `;
            });
            list.innerHTML = html || '<div style="text-align: center; color: #999; padding: 10px;">暂无日记记录</div>';
        }

        function escapeHtml(str) {
            return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
        }

        // 清空功能
        function triggerClearEntry() {
            clickCount++;
            const triggerEl = document.querySelector('.clear-trigger');
            triggerEl.style.color = '#ff7043';
            setTimeout(() => {
                triggerEl.style.color = clickCount >= 5 ? '#666' : '#999';
            }, 300);

            if (clickCount >= 5) {
                document.getElementById('clearCode').style.display = 'inline-block';
                document.querySelector('.btn-special[onclick="checkClearCode()"]').style.display = 'inline-block';
                triggerEl.textContent = '输入密码即可清空日记';
                clickCount = 0;
            } else {
                triggerEl.textContent = `点击 ${5 - clickCount} 次显示日记清空功能`;
            }
        }

        function checkClearCode() {
            const code = document.getElementById('clearCode').value.trim();
            if (code === '25014105') {
                if (confirm('确定要清空所有日记吗？此操作不可恢复！')) {
                    localStorage.removeItem('diaries');
                    renderDiaries();
                    document.getElementById('clearCode').value = '';
                    document.getElementById('clearCode').style.display = 'none';
                    document.querySelector('.btn-special[onclick="checkClearCode()"]').style.display = 'none';
                    document.querySelector('.clear-trigger').textContent = '点击5次显示日记清空功能';
                }
            } else {
                alert('密码错误！请输入正确密码');
                document.getElementById('clearCode').value = '';
            }
        }

        // 初始化
        window.addEventListener('load', () => {
            initTimer();
            renderDiaries();
        });

        window.addEventListener('unload', () => {
            if (timerInterval) clearInterval(timerInterval);
        });
    </script>
</body>
</html>
